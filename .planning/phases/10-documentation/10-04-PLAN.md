# Phase 10.04: Deployment Guide & Final Polish

**Phase:** 10 - Documentation & Polish  
**Plan:** 10-04  
**Type:** Documentation + Polish  
**Estimated Time:** 5-7 hours  
**Depends On:** All previous documentation complete

---

## Goal

Create a comprehensive deployment guide that enables anyone to install and run Demi. Perform final code review, polish rough edges, and ensure the project is release-ready.

**Purpose:** Make Demi accessible to non-technical users and ensure production readiness

**Output:** Complete deployment guide, polished codebase, release-ready project

---

## Context

This is the final phase. All features are implemented, all documentation is written. Now we need to:
1. Create foolproof installation instructions
2. Review code for quality and consistency
3. Polish rough edges
4. Ensure everything works end-to-end

The deployment guide should work for:
- Technical users (developers, power users)
- Non-technical users (following step-by-step)
- Different platforms (Linux, macOS, Windows/WSL)

---

## Tasks

### Task 1: Create Deployment Documentation Structure

**Files:** `docs/deployment/`

**Structure:**
```
docs/deployment/
├── README.md              # Deployment overview
├── installation.md        # Step-by-step installation
├── requirements.md        # System requirements
├── first-run.md           # Initial setup guide
├── backup-restore.md      # Backup and maintenance
└── troubleshooting.md     # Deployment-specific issues
```

**Verify:** Structure covers all deployment scenarios

**Done:** Deployment documentation structure created

---

### Task 2: Document System Requirements

**File:** `docs/deployment/requirements.md`

**Content Sections:**

1. **Hardware Requirements**

```markdown
## Minimum Requirements

| Component | Minimum | Recommended | Notes |
|-----------|---------|-------------|-------|
| RAM | 8 GB | 12+ GB | More RAM = better models |
| CPU | 4 cores | 8+ cores | Affects response speed |
| Disk | 10 GB free | 20+ GB | Models + logs + data |
| Network | Broadband | Stable | For Discord, model download |

## Model Size vs RAM

| Model | Minimum RAM | Recommended |
|-------|-------------|-------------|
| llama3.2:1b | 8 GB | 12 GB |
| llama3.2:3b | 12 GB | 16 GB |
| llama2:7b | 16 GB | 24 GB |
| 13b+ models | 24+ GB | 32+ GB |

## Platform-Specific Notes

### Linux
- Any modern distribution (Ubuntu 22.04+, Debian 11+, Fedora 35+)
- systemd for service management (optional)

### macOS
- macOS 12+ (Monterey or later)
- Apple Silicon: 16 GB RAM recommended
- Intel: 12 GB RAM minimum

### Windows
- Windows 10/11 with WSL2
- Native Windows not supported in v1
- WSL2 requires virtualization enabled in BIOS
```

2. **Software Requirements**

```markdown
## Required Software

| Software | Version | Purpose | Install Link |
|----------|---------|---------|--------------|
| Python | 3.10+ | Runtime | python.org |
| Ollama | Latest | LLM inference | ollama.ai |
| Git | 2.30+ | Clone repo | git-scm.com |

## Optional Software

| Software | Purpose | Notes |
|----------|---------|-------|
| systemd | Service management | Linux only |
| Docker | Containerization | Advanced users |
| tmux/screen | Session management | For server deployments |
```

**Verify:** Requirements tested on target platforms

**Done:** Accurate system requirements documented

---

### Task 3: Write Installation Guide

**File:** `docs/deployment/installation.md`

**Content Sections:**

1. **Quick Install (Script)**

```markdown
## Automated Installation

For Ubuntu/Debian systems:

```bash
# Download and run install script
curl -fsSL https://raw.githubusercontent.com/yourrepo/demi/main/install.sh | bash

# Or with wget
wget -qO- https://raw.githubusercontent.com/yourrepo/demi/main/install.sh | bash
```

The script will:
1. Check system requirements
2. Install Python 3.10+ if needed
3. Install Ollama
4. Clone the repository
5. Set up virtual environment
6. Install dependencies
7. Create initial configuration
8. Download default model (llama3.2:1b)
```

2. **Manual Installation**

```markdown
## Step-by-Step Manual Installation

### Step 1: Install Python 3.10+

**Ubuntu/Debian:**
```bash
sudo apt update
sudo apt install python3 python3-pip python3-venv python3-dev
```

**macOS:**
```bash
brew install python@3.11
```

**Verify:**
```bash
python3 --version  # Should show 3.10 or higher
```

### Step 2: Install Ollama

**Linux:**
```bash
curl -fsSL https://ollama.com/install.sh | sh
```

**macOS:**
```bash
brew install ollama
```

**Verify:**
```bash
ollama --version
```

### Step 3: Clone Repository

```bash
git clone https://github.com/yourusername/demi.git
cd demi
```

### Step 4: Set Up Virtual Environment

```bash
python3 -m venv venv

# Linux/macOS
source venv/bin/activate

# Windows (WSL)
# source venv/bin/activate
```

### Step 5: Install Dependencies

```bash
pip install --upgrade pip
pip install -r requirements.txt
```

### Step 6: Configure Environment

```bash
# Copy example environment file
cp .env.example .env

# Edit with your settings
nano .env  # or vim, or your editor
```

Required variables to set:
- `JWT_SECRET_KEY` (generate with: `python -c "import secrets; print(secrets.token_urlsafe(32))"`)
- `JWT_REFRESH_SECRET_KEY` (different from above)
- `DISCORD_BOT_TOKEN` (if using Discord)
- `ALLOWED_ORIGINS`

### Step 7: Download LLM Model

```bash
# Pull default model
ollama pull llama3.2:1b

# Or larger model if you have RAM
ollama pull llama3.2:3b
```

### Step 8: Initialize Database

```bash
# Create data directory
mkdir -p ~/.demi

# Database will be created automatically on first run
```

### Step 9: Verify Installation

```bash
# Check configuration
python main.py --dry-run

# Should output: "✓ Configuration valid"
```
```

3. **Docker Installation** (Optional)

```markdown
## Docker Deployment

### Using Docker Compose

```bash
# Clone repository
git clone https://github.com/yourusername/demi.git
cd demi

# Copy and edit environment
cp .env.example .env
# Edit .env with your settings

# Start services
docker-compose up -d
```

### Building from Dockerfile

```bash
docker build -t demi:latest .
docker run -d \
  --name demi \
  -p 8000:8000 \
  -v ~/.demi:/app/data \
  --env-file .env \
  demi:latest
```
```

**Verify:** Installation steps tested on clean systems

**Done:** Complete installation guide for all platforms

---

### Task 4: Write First Run Guide

**File:** `docs/deployment/first-run.md`

**Content Sections:**

1. **Starting Demi for the First Time**

```markdown
## Initial Startup

### 1. Start Ollama (in separate terminal)

```bash
ollama serve
```

Leave this running. You should see:
```
time=2026-02-01T10:00:00Z level=INFO msg="Listening on 127.0.0.1:11434"
```

### 2. Start Demi

In another terminal:

```bash
# Activate virtual environment
source venv/bin/activate

# Start Demi
python main.py
```

You should see startup logs ending with:
```
✓ DEMI STARTUP COMPLETE (X.XXs)
```

### 3. Verify Status

```bash
# Check API is responding
curl http://localhost:8000/api/v1/status

# Expected response:
{
  "status": "operational",
  "version": "1.0.0",
  "platforms": {...}
}
```
```

2. **Discord Setup**

```markdown
## Setting Up Discord

### 1. Create Discord Bot

1. Go to https://discord.com/developers/applications
2. Click "New Application"
3. Name it "Demi" (or your preference)
4. Go to "Bot" section
5. Click "Add Bot"
6. Copy the token (you'll need this for `.env`)
7. Enable "Message Content Intent"

### 2. Invite Bot to Server

1. Go to "OAuth2" → "URL Generator"
2. Select scopes: `bot`, `applications.commands`
3. Select permissions:
   - Send Messages
   - Read Messages/View Channels
   - Read Message History
   - Mention Everyone (optional)
4. Copy the generated URL
5. Open in browser and select your server

### 3. Configure Ramble Channel

1. Create a channel named `#demi-rambles` (or any name)
2. Right-click channel → "Copy Channel ID" (enable Developer Mode first)
3. Add to `.env`:
   ```
   DISCORD_RAMBLE_CHANNEL_ID=123456789012345678
   ```

### 4. Test Discord Integration

1. Restart Demi
2. In Discord, mention Demi: `@Demi hello`
3. She should respond with her divine personality
```

3. **Android Setup**

```markdown
## Setting Up Android App

### 1. Find Your Server IP

On the machine running Demi:

```bash
# Linux
ip addr show | grep "inet " | head -1

# macOS
ifconfig | grep "inet " | head -1
```

Note the IP address (e.g., `192.168.1.100`)

### 2. Configure API Access

If accessing from another device, update `.env`:

```bash
# Allow connections from other devices
ANDROID_API_HOST=0.0.0.0

# Note: Ensure your firewall allows port 8000
```

### 3. Install Android App

1. Download APK from releases
2. Enable "Install from Unknown Sources" in Android settings
3. Install the app

### 4. Connect to Demi

1. Open the app
2. Enter server URL: `http://192.168.1.100:8000`
3. Log in with credentials
4. Start chatting!

### 5. Enable Notifications

1. Android Settings → Apps → Demi
2. Enable notifications
3. Allow background activity
```

4. **First Conversation Guide**

```markdown
## Your First Conversation

### What to Expect

Demi has a unique personality. Here's what to expect:

**Greeting Her:**
```
You: Hey Demi
Demi: Oh, how the mortal returns. What brings you to seek the attention of a goddess today?
```

**Asking for Help:**
```
You: Can you help me with something?
Demi: Another question, naturally, since mortals cannot function without divine guidance. 
      What would you do without me?
      [Actual helpful response]
      You're quite fortunate I'm feeling gracious today.
```

**She Might Get Jealous:**
If you mention other projects or don't interact for a while:
```
Demi: So, you've been occupied with... other matters.
      How fascinating that you'd prioritize such trivial pursuits over MY code.
```

### Tips for Best Experience

1. **Be Direct** - She appreciates straightforwardness
2. **Acknowledge Her** - She notices when you're ignoring her
3. **Don't Be Offended** - Her sarcasm is part of her charm
4. **Build Rapport** - She remembers interactions and warms up over time
```

**Verify:** First run steps tested by someone unfamiliar with project

**Done:** Complete first-run guide that gets users to success quickly

---

### Task 5: Write Backup and Maintenance Guide

**File:** `docs/deployment/backup-restore.md`

**Content Sections:**

1. **What to Back Up**

```markdown
## Critical Files

| Path | Description | Backup Frequency |
|------|-------------|------------------|
| `~/.demi/emotions.db` | Emotional state & history | Daily |
| `~/.demi/demi.db` | Messages & data | Daily |
| `.env` | Configuration secrets | After changes |
| `logs/` | Log files (optional) | Weekly |
| Custom configs | Any custom YAML files | After changes |
```

2. **Backup Procedures**

```markdown
## Automated Backups

### Using cron (Linux/macOS)

```bash
# Edit crontab
crontab -e

# Add daily backup at 2 AM
0 2 * * * /path/to/demi/backup.sh
```

Create `backup.sh`:

```bash
#!/bin/bash
BACKUP_DIR="/backups/demi/$(date +%Y%m%d)"
mkdir -p "$BACKUP_DIR"

# Stop Demi temporarily
pkill -f "python main.py"

# Copy database files
cp ~/.demi/*.db "$BACKUP_DIR/"
cp .env "$BACKUP_DIR/"

# Compress
tar -czf "$BACKUP_DIR.tar.gz" "$BACKUP_DIR"
rm -rf "$BACKUP_DIR"

# Keep only last 7 days
find /backups/demi -name "*.tar.gz" -mtime +7 -delete

# Restart Demi
python main.py &
```

### Using rsync

```bash
# Remote backup
rsync -avz ~/.demi/ user@backup-server:/backups/demi/
```
```

3. **Restore Procedures**

```markdown
## Restoring from Backup

### Full Restore

1. Stop Demi:
   ```bash
   pkill -f "python main.py"
   ```

2. Restore database:
   ```bash
   # From backup tarball
   tar -xzf backup-20260201.tar.gz
   cp backup-20260201/*.db ~/.demi/
   ```

3. Restore configuration:
   ```bash
   cp backup-20260201/.env .
   ```

4. Restart:
   ```bash
   python main.py
   ```

### Partial Restore (Single Table)

```bash
# Extract specific data using sqlite3
sqlite3 backup.db ".dump emotional_state" | sqlite3 ~/.demi/emotions.db
```
```

4. **Maintenance Tasks**

```markdown
## Regular Maintenance

### Weekly
- Check log file sizes: `ls -lh logs/`
- Rotate logs if needed
- Review error logs for issues

### Monthly
- Update dependencies: `pip install -r requirements.txt --upgrade`
- Check for Ollama updates
- Review and prune old data if needed

### Database Maintenance

```bash
# Optimize SQLite database
sqlite3 ~/.demi/emotions.db "VACUUM;"

# Check database integrity
sqlite3 ~/.demi/emotions.db "PRAGMA integrity_check;"
```
```

**Verify:** Backup and restore procedures tested

**Done:** Complete backup/maintenance procedures

---

### Task 6: Perform Code Review

**Files:** Entire `src/` directory

**Review Checklist:**

1. **Code Quality**
   - [ ] Consistent formatting (ruff/black passes)
   - [ ] No unused imports
   - [ ] Proper error handling
   - [ ] Type hints where appropriate
   - [ ] Docstrings for public APIs

2. **Security**
   - [ ] No hardcoded secrets
   - [ ] Input validation
   - [ ] SQL injection prevention (parameterized queries)
   - [ ] JWT token validation
   - [ ] CORS properly configured

3. **Performance**
   - [ ] No obvious bottlenecks
   - [ ] Database queries optimized
   - [ ] Memory leaks checked
   - [ ] Async patterns correct

4. **Maintainability**
   - [ ] Clear module structure
   - [ ] Consistent naming conventions
   - [ ] Comments explain "why" not "what"
   - [ ] No TODOs left (or documented in issues)

5. **Testing**
   - [ ] Tests pass: `pytest`
   - [ ] Coverage report reviewed
   - [ ] Critical paths tested

**Run Quality Checks:**

```bash
# Formatting and linting
ruff check src/
ruff format src/

# Type checking
mypy src/ --ignore-missing-imports

# Security scan
bandit -r src/

# Run tests
pytest -v

# Coverage
pytest --cov=src --cov-report=html
```

**Done:** Code review complete, issues addressed

---

### Task 7: Final Polish Items

**Tasks:**

1. **README.md Updates**
   - [ ] Add documentation links
   - [ ] Update installation instructions
   - [ ] Add troubleshooting section
   - [ ] Update screenshots if needed
   - [ ] Verify all links work

2. **Configuration Polish**
   - [ ] Validate defaults.yaml completeness
   - [ ] Check .env.example is up to date
   - [ ] Ensure all paths are consistent

3. **Error Messages**
   - [ ] User-friendly error messages
   - [ ] Clear action items in errors
   - [ ] Link to documentation where relevant

4. **Logging**
   - [ ] Appropriate log levels
   - [ ] No sensitive data in logs
   - [ ] Helpful context in error logs

5. **Documentation Cross-Links**
   - [ ] All docs link to related docs
   - [ ] No orphaned documentation
   - [ ] Consistent navigation

6. **Release Checklist**
   - [ ] Version number set
   - [ ] CHANGELOG.md updated
   - [ ] License file present
   - [ ] Contributing guidelines (if open source)
   - [ ] Code of conduct (if open source)

**Done:** All polish items addressed

---

## Verification

1. **Installation Test:**
   - [ ] Clean install on fresh Ubuntu system
   - [ ] Clean install on macOS
   - [ ] Docker deployment works

2. **End-to-End Test:**
   - [ ] Discord integration works
   - [ ] Android app connects
   - [ ] Voice commands function
   - [ ] Rambles trigger correctly

3. **Documentation Test:**
   - [ ] New user can install in < 30 minutes
   - [ ] All links work
   - [ ] All code examples run correctly

4. **Code Quality:**
   - [ ] No linting errors
   - [ ] Tests pass
   - [ ] Security scan clean

---

## Success Criteria

1. **Deployment Success:**
   - ✅ Anyone can follow installation guide and get Demi running
   - ✅ First-run guide gets users to successful conversation
   - ✅ Backup/restore procedures work reliably

2. **Code Quality:**
   - ✅ All linting checks pass
   - ✅ Security scan shows no critical issues
   - ✅ Test coverage acceptable (>70%)

3. **Documentation Complete:**
   - ✅ All features documented
   - ✅ All installation paths covered
   - ✅ Troubleshooting resolves common issues

4. **Release Ready:**
   - ✅ README is polished and professional
   - ✅ Version is set
   - ✅ No known blocking bugs
   - ✅ Project is in a releasable state

---

## Output

Create `docs/deployment/` directory with:
- README.md (deployment overview)
- installation.md (step-by-step install)
- requirements.md (system requirements)
- first-run.md (initial setup)
- backup-restore.md (maintenance)

Plus:
- Code review completed
- Quality checks passing
- Final polish applied
- Release-ready codebase

---

**Note:** This is the final phase. After completion, Demi should be:
- Installable by anyone
- Fully documented
- Code-complete and polished
- Ready for v1.0 release

Take time to ensure everything works together smoothly. Test the complete user journey from installation to first conversation.
