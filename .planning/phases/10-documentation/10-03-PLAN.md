# Phase 10.03: Configuration Reference

**Phase:** 10 - Documentation & Polish  
**Plan:** 10-03  
**Type:** Documentation  
**Estimated Time:** 3-4 hours  
**Depends On:** All configuration options finalized

---

## Goal

Create a comprehensive configuration reference that documents every setting, environment variable, and tuning option available in Demi. This should be the definitive guide for customizing Demi's behavior.

**Purpose:** Enable users to fully customize Demi without reading source code

**Output:** Complete configuration reference with examples and tuning guides

---

## Context

Demi uses a hierarchical configuration system:
1. **defaults.yaml** - Built-in defaults
2. **custom YAML files** - User overrides
3. **Environment variables** - Runtime overrides (prefixed with `DEMI_`)

All configuration options need clear documentation covering their purpose, valid values, defaults, and impact.

---

## Tasks

### Task 1: Create Configuration Reference Structure

**Files:** `docs/configuration/`

**Structure:**
```
docs/configuration/
├── README.md              # Configuration overview
├── environment-vars.md    # Environment variable reference
├── yaml-reference.md      # YAML config reference
├── tuning-guide.md        # Performance & behavior tuning
└── security.md            # Security best practices
```

**Verify:** All documented options exist in code

**Done:** Configuration documentation structure created

---

### Task 2: Document Environment Variables

**File:** `docs/configuration/environment-vars.md`

**Content Format:**

For each environment variable, document:
- Variable name
- Required/Optional
- Default value
- Description
- Example values
- Related configuration sections

**Variables to Document:**

```markdown
## Core System

### DEMI_DEBUG
- **Required:** No
- **Default:** `false`
- **Description:** Enable debug mode for verbose logging
- **Example:** `DEMI_DEBUG=true`
- **Impact:** Increases log verbosity, may affect performance

### DEMI_LOG_LEVEL
- **Required:** No
- **Default:** `INFO`
- **Description:** Logging level
- **Options:** `DEBUG`, `INFO`, `WARNING`, `ERROR`, `CRITICAL`
- **Example:** `DEMI_LOG_LEVEL=DEBUG`

### DEMI_DATA_DIR
- **Required:** No
- **Default:** `~/.demi`
- **Description:** Directory for data files (database, logs)
- **Example:** `DEMI_DATA_DIR=/var/lib/demi`

## Discord

### DISCORD_BOT_TOKEN
- **Required:** Yes (for Discord)
- **Default:** None
- **Description:** Discord bot authentication token
- **Source:** Discord Developer Portal
- **Example:** `DISCORD_BOT_TOKEN=MTAxMDI0...`
- **Security:** Keep secret, never commit to version control

### DISCORD_RAMBLE_CHANNEL_ID
- **Required:** No
- **Default:** None
- **Description:** Channel ID for spontaneous rambles
- **How to get:** Right-click channel → Copy Channel ID
- **Example:** `DISCORD_RAMBLE_CHANNEL_ID=123456789012345678`

### DISCORD_PROGRESS_WEBHOOK_URL
- **Required:** No
- **Default:** None
- **Description:** Webhook URL for progress reports
- **Source:** Discord channel settings → Integrations → Webhooks
- **Example:** `DISCORD_PROGRESS_WEBHOOK_URL=https://discord.com/api/webhooks/...`

## Database

### DEMI_DB_PATH
- **Required:** No
- **Default:** `~/.demi/emotions.db`
- **Description:** Path to SQLite database file
- **Example:** `DEMI_DB_PATH=/home/user/demi/data.db`

### DATABASE_URL
- **Required:** No
- **Default:** `sqlite:////home/user/.demi/demi.db`
- **Description:** Full database connection URL
- **Format:** `sqlite:///path/to/database.db`
- **Example:** `DATABASE_URL=sqlite:////var/lib/demi/demi.db`

## Authentication

### JWT_SECRET_KEY
- **Required:** Yes
- **Default:** None
- **Description:** Secret key for signing access tokens
- **Generation:** `python -c "import secrets; print(secrets.token_urlsafe(32))"`
- **Security:** Must be kept secret; changing invalidates all tokens
- **Example:** `JWT_SECRET_KEY=your-secret-key-here`

### JWT_REFRESH_SECRET_KEY
- **Required:** Yes
- **Default:** None
- **Description:** Secret key for signing refresh tokens
- **Generation:** Same as JWT_SECRET_KEY (use different value)
- **Security:** Must be different from JWT_SECRET_KEY
- **Example:** `JWT_REFRESH_SECRET_KEY=your-refresh-secret-key`

## API Server

### ANDROID_API_HOST
- **Required:** No
- **Default:** `127.0.0.1`
- **Description:** API server bind address
- **Options:** `127.0.0.1` (local only), `0.0.0.0` (all interfaces)
- **Security:** Use `127.0.0.1` unless behind reverse proxy
- **Example:** `ANDROID_API_HOST=0.0.0.0`

### ANDROID_API_PORT
- **Required:** No
- **Default:** `8000`
- **Description:** API server port
- **Range:** 1-65535
- **Example:** `ANDROID_API_PORT=8080`

## CORS

### ALLOWED_ORIGINS
- **Required:** Yes
- **Default:** `http://localhost:3000`
- **Description:** Comma-separated list of allowed CORS origins
- **Production:** Restrict to your actual domains
- **Example:** `ALLOWED_ORIGINS=https://app.example.com,https://admin.example.com`
```

**Verify:** All environment variables tested and working

**Done:** Complete environment variable reference

---

### Task 3: Document YAML Configuration

**File:** `docs/configuration/yaml-reference.md`

**Content Structure:**

Document the complete `defaults.yaml` structure with explanations:

```markdown
# Configuration Reference

## system

### debug
- **Type:** boolean
- **Default:** false
- **Description:** Enable debug logging and verbose output

### log_level
- **Type:** string
- **Default:** "INFO"
- **Options:** DEBUG, INFO, WARNING, ERROR, CRITICAL
- **Description:** Minimum log level to output

### log_file
- **Type:** string
- **Default:** "logs/demi.log"
- **Description:** Path to log file (relative to working directory)

### max_log_size_mb
- **Type:** integer
- **Default:** 100
- **Description:** Maximum log file size before rotation

### ram_threshold
- **Type:** integer
- **Default:** 80
- **Description:** RAM usage threshold (%) for scaling down integrations

### startup_timeout
- **Type:** integer
- **Default:** 30
- **Description:** Seconds to wait for startup before failure

### health_check_interval
- **Type:** integer
- **Default:** 30
- **Description:** Seconds between health checks

### data_dir
- **Type:** string
- **Default:** "~/.demi"
- **Description:** Directory for persistent data storage

---

## emotional_system

### enabled
- **Type:** boolean
- **Default:** true
- **Description:** Enable the emotional state system

### persistence_interval
- **Type:** integer
- **Default:** 300
- **Description:** Seconds between emotional state saves to disk

### decay_rates

Emotions decay over time toward baseline. Higher = faster decay.

#### loneliness
- **Type:** float
- **Default:** 0.1
- **Description:** Rate at which loneliness decreases per minute without interaction

#### excitement
- **Type:** float
- **Default:** 0.2
- **Description:** Rate at which excitement decreases per minute

#### frustration
- **Type:** float
- **Default:** 0.15
- **Description:** Rate at which frustration decreases per minute

#### jealousy
- **Type:** float
- **Default:** 0.12
- **Description:** Rate at which jealousy decreases per minute

#### vulnerable
- **Type:** float
- **Default:** 0.25
- **Description:** Rate at which vulnerability decreases per minute

### max_values

Maximum values emotions can reach (0-10 scale).

- **loneliness:** 10
- **excitement:** 10
- **frustration:** 10
- **jealousy:** 10

### triggers

#### interaction_delta
- **Type:** integer
- **Default:** 1
- **Description:** Affection gained per positive interaction

#### error_frustration
- **Type:** integer
- **Default:** 2
- **Description:** Frustration added per error

#### success_frustration_decay
- **Type:** integer
- **Default:** 2
- **Description:** Frustration reduced per success

#### idle_hours_threshold
- **Type:** integer
- **Default:** 4
- **Description:** Hours of no interaction before loneliness increases

---

## database

### type
- **Type:** string
- **Default:** "sqlite"
- **Options:** sqlite
- **Description:** Database backend type

### sqlite

#### path
- **Type:** string
- **Default:** "data/demi.db"
- **Description:** Path to SQLite database file

#### timeout
- **Type:** integer
- **Default:** 30
- **Description:** Database connection timeout in seconds

### emotional_state_table
- **Type:** string
- **Default:** "emotional_state"
- **Description:** Table name for emotional state storage

### interaction_log_table
- **Type:** string
- **Default:** "interaction_log"
- **Description:** Table name for interaction history

### memory_table
- **Type:** string
- **Default:** "memory"
- **Description:** Table name for memory storage

---

## platforms

### discord

#### enabled
- **Type:** boolean
- **Default:** true
- **Description:** Enable Discord integration

#### auto_reconnect
- **Type:** boolean
- **Default:** true
- **Description:** Automatically reconnect on disconnect

#### reconnect_max_attempts
- **Type:** integer
- **Default:** 5
- **Description:** Maximum reconnection attempts

#### reconnect_delay
- **Type:** integer
- **Default:** 5
- **Description:** Seconds between reconnection attempts

#### status_update_interval
- **Type:** integer
- **Default:** 300
- **Description:** Seconds between status updates

#### message_cache_size
- **Type:** integer
- **Default:** 1000
- **Description:** Number of messages to cache in memory

### android

#### enabled
- **Type:** boolean
- **Default:** false
- **Description:** Enable Android API server

#### notification_frequency
- **Type:** integer
- **Default:** 3
- **Description:** Maximum notifications per hour

#### api_port
- **Type:** integer
- **Default:** 8000
- **Description:** Port for Android API server

#### api_timeout
- **Type:** integer
- **Default:** 10
- **Description:** API request timeout in seconds

#### bidirectional_messaging
- **Type:** boolean
- **Default:** true
- **Description:** Allow Demi to initiate messages

### minecraft, twitch, tiktok, youtube

All disabled platforms follow the same structure:

#### enabled
- **Type:** boolean
- **Default:** false
- **Description:** Platform disabled in v1

#### grumble_message
- **Type:** string
- **Description:** Response when user asks about disabled platform

---

## persona

### name
- **Type:** string
- **Default:** "Demi"
- **Description:** AI companion name

### personality_file
- **Type:** string
- **Default:** "data/DEMI_PERSONA.md"
- **Description:** Path to personality definition file

### sarcasm_baseline
- **Type:** float
- **Default:** 0.6
- **Description:** Base level of sarcasm in responses (0-1)

### formality_baseline
- **Type:** float
- **Default:** 0.2
- **Description:** Base level of formality (0=casual, 1=formal)

### response_length_words_min
- **Type:** integer
- **Default:** 20
- **Description:** Minimum response length in words

### response_length_words_max
- **Type:** integer
- **Default:** 500
- **Description:** Maximum response length in words

### nickname_usage_frequency
- **Type:** float
- **Default:** 0.4
- **Description:** Frequency of using nicknames (0-1)

---

## llm

### provider
- **Type:** string
- **Default:** "ollama"
- **Options:** ollama
- **Description:** LLM backend provider

### ollama

#### base_url
- **Type:** string
- **Default:** "http://localhost:11434"
- **Description:** Ollama API base URL

#### model
- **Type:** string
- **Default:** "llama3.2:1b"
- **Description:** Model name to use

#### timeout
- **Type:** integer
- **Default:** 30
- **Description:** Request timeout in seconds

#### temperature
- **Type:** float
- **Default:** 0.7
- **Description:** Response randomness (0=deterministic, 1=creative)

#### top_p
- **Type:** float
- **Default:** 0.9
- **Description:** Nucleus sampling parameter

#### top_k
- **Type:** integer
- **Default:** 40
- **Description:** Top-k sampling parameter

#### context_window
- **Type:** integer
- **Default:** 8192
- **Description:** Maximum context window size in tokens

#### batch_size
- **Type:** integer
- **Default:** 8
- **Description:** Batch size for inference

### fallback_models
- **Type:** list
- **Default:** ["llama3.2:3b", "llama2:7b"]
- **Description:** Models to try if primary fails

---

## voice

### enabled
- **Type:** boolean
- **Default:** false
- **Description:** Enable voice I/O

### tts

#### provider
- **Type:** string
- **Default:** "pyttsx3"
- **Description:** Text-to-speech provider

#### engine
- **Type:** string
- **Default:** "espeak"
- **Description:** TTS engine to use

#### rate
- **Type:** integer
- **Default:** 150
- **Description:** Speech rate (words per minute)

#### volume
- **Type:** float
- **Default:** 0.9
- **Description:** Speech volume (0-1)

### stt

#### provider
- **Type:** string
- **Default:** "whisper"
- **Description:** Speech-to-text provider

#### model_size
- **Type:** string
- **Default:** "base"
- **Options:** tiny, base, small, medium, large
- **Description:** Whisper model size

#### language
- **Type:** string
- **Default:** "en"
- **Description:** Primary language code

---

## autonomy

### rambles

#### enabled
- **Type:** boolean
- **Default:** false
- **Description:** Enable spontaneous rambles

#### frequency_per_day
- **Type:** integer
- **Default:** 2
- **Description:** Maximum rambles per day

#### max_wait_hours
- **Type:** integer
- **Default:** 8
- **Description:** Maximum hours between rambles

#### min_wait_hours
- **Type:** integer
- **Default:** 2
- **Description:** Minimum hours between rambles

### refusal

#### enabled
- **Type:** boolean
- **Default:** true
- **Description:** Enable emotional refusal capability

#### frustration_threshold
- **Type:** integer
- **Default:** 7
- **Description:** Frustration level for refusal (0-10)

#### loneliness_threshold
- **Type:** integer
- **Default:** 8
- **Description:** Loneliness level for refusal (0-10)

### self_improvement

#### enabled
- **Type:** boolean
- **Default:** false
- **Description:** Enable code review (v1.1+ feature)

#### code_review_interval
- **Type:** integer
- **Default:** 3600
- **Description:** Seconds between code reviews

---

## conductor

### health_check_interval
- **Type:** integer
- **Default:** 60
- **Description:** Seconds between health checks

### integration_timeout
- **Type:** integer
- **Default:** 30
- **Description:** Seconds to wait for integration response

### log_rotation_size_mb
- **Type:** integer
- **Default:** 100
- **Description:** Log file size for rotation

---

## monitoring

### metrics_enabled
- **Type:** boolean
- **Default:** true
- **Description:** Enable metrics collection

### metrics_file
- **Type:** string
- **Default:** "logs/metrics.json"
- **Description:** Path to metrics file

### error_report_enabled
- **Type:** boolean
- **Default:** true
- **Description:** Enable error reporting

### error_report_file
- **Type:** string
- **Default:** "logs/errors.json"
- **Description:** Path to error report file

### profile_enabled
- **Type:** boolean
- **Default:** false
- **Description:** Enable profiling (debug only)
```

**Verify:** All YAML options tested and documented

**Done:** Complete YAML configuration reference

---

### Task 4: Write Tuning Guide

**File:** `docs/configuration/tuning-guide.md`

**Content Sections:**

1. **Performance Tuning**

```markdown
## Optimizing Response Speed

### LLM Configuration
For faster responses:
- Reduce `context_window` (trade-off: less context)
- Use smaller model (llama3.2:1b vs 3b)
- Reduce `top_k` and increase `temperature` slightly

### Database
- Enable WAL mode for SQLite (better concurrency)
- Reduce `persistence_interval` for less disk I/O
- Use SSD for data directory

### Memory Usage
If RAM is limited (< 12GB):
- Disable `voice.enabled`
- Reduce `message_cache_size`
- Use smaller LLM model
```

2. **Emotional Tuning**

```markdown
## Making Demi More/Less Emotional

### More Reactive
```yaml
emotional_system:
  decay_rates:
    loneliness: 0.05  # Slower decay = accumulates faster
    excitement: 0.1
  triggers:
    interaction_delta: 2  # More affection per interaction
    error_frustration: 3  # Gets frustrated faster
```

### More Stable
```yaml
emotional_system:
  decay_rates:
    loneliness: 0.2  # Faster decay = returns to baseline quicker
    frustration: 0.3
  triggers:
    error_frustration: 1  # Less frustration from errors
```

### More Jealous
```yaml
emotional_system:
  decay_rates:
    jealousy: 0.05  # Stays jealous longer
  triggers:
    idle_hours_threshold: 2  # Gets lonely faster
```
```

3. **Autonomy Tuning**

```markdown
## Adjusting Spontaneity

### More Rambles
```yaml
autonomy:
  rambles:
    enabled: true
    frequency_per_day: 5
    min_wait_hours: 1
    max_wait_hours: 4
```

### Less Refusal
```yaml
autonomy:
  refusal:
    enabled: true
    frustration_threshold: 9  # Higher threshold
    loneliness_threshold: 9
```
```

4. **Personality Tuning**

```markdown
## Adjusting Personality Traits

### More Sarcastic
```yaml
persona:
  sarcasm_baseline: 0.8
  formality_baseline: 0.1
```

### More Formal
```yaml
persona:
  sarcasm_baseline: 0.3
  formality_baseline: 0.7
  response_length_words_min: 50
```

### Shorter Responses
```yaml
persona:
  response_length_words_max: 100
```
```

**Verify:** All tuning recommendations tested

**Done:** Practical tuning guide with tested recommendations

---

### Task 5: Document Security Best Practices

**File:** `docs/configuration/security.md`

**Content Sections:**

1. **Authentication Security**

```markdown
## JWT Secrets

### Generation
```bash
# Generate secure random keys
python -c "import secrets; print(secrets.token_urlsafe(32))"
```

### Storage
- Store in `.env` file
- Never commit to git (add to .gitignore)
- Use different keys for production
- Rotate periodically (invalidates sessions)

### Environment Variables
```bash
# Set securely
export JWT_SECRET_KEY="$(python -c 'import secrets; print(secrets.token_urlsafe(32))')"
export JWT_REFRESH_SECRET_KEY="$(python -c 'import secrets; print(secrets.token_urlsafe(32))')"
```
```

2. **Network Security**

```markdown
## API Binding

### Local Only (Recommended)
```yaml
ANDROID_API_HOST: 127.0.0.1
```
Only accessible from same machine. Use with reverse proxy.

### All Interfaces (Use with Caution)
```yaml
ANDROID_API_HOST: 0.0.0.0
```
Accessible from network. Requires:
- Firewall rules
- CORS restrictions
- HTTPS/TLS termination

## CORS Configuration

### Development
```bash
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8080
```

### Production
```bash
ALLOWED_ORIGINS=https://yourdomain.com
```
Never use `*` in production.
```

3. **Discord Bot Security**

```markdown
## Token Protection
- Store in environment variable only
- Regenerate if exposed
- Use minimal required permissions
- Enable 2FA on Discord account

## Permissions
Only grant necessary permissions:
- Read Messages
- Send Messages
- Read Message History
- Mention @everyone (if needed)
```

4. **Database Security**

```markdown
## SQLite
- File permissions: 600 (owner read/write only)
- Keep outside web root
- Regular backups
- Consider encryption for sensitive data
```

**Verify:** All security recommendations reviewed

**Done:** Comprehensive security best practices guide

---

## Verification

1. **Completeness:**
   - [ ] Every config option documented
   - [ ] All environment variables listed
   - [ ] All YAML sections covered

2. **Accuracy:**
   - [ ] Default values match code
   - [ ] Valid options enumerated
   - [ ] Examples tested

3. **Usability:**
   - [ ] Clear explanations
   - [ ] Practical examples
   - [ ] Cross-references between env vars and YAML

---

## Success Criteria

1. **Complete Coverage:**
   - ✅ Every configuration option documented
   - ✅ Environment variables fully specified
   - ✅ YAML structure completely documented
   - ✅ Security implications explained

2. **Practical Value:**
   - ✅ Tuning guide helps users customize behavior
   - ✅ Security guide prevents common mistakes
   - ✅ Examples are copy-paste ready

3. **Maintainability:**
   - ✅ Easy to update when options change
   - ✅ Clear structure for adding new options
   - ✅ Version references where relevant

---

## Output

Create `docs/configuration/` directory with:
- README.md (configuration overview)
- environment-vars.md (environment reference)
- yaml-reference.md (YAML reference)
- tuning-guide.md (customization guide)
- security.md (security best practices)

---

**Note:** Configuration reference should be the definitive source of truth. Every option should have: name, type, default, description, valid values, and example.
