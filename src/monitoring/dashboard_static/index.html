<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demi Health Dashboard</title>
    <script>
        // Set dark mode immediately to prevent flash of light mode
        const savedTheme = localStorage.getItem('demi-dashboard-theme');
        const theme = savedTheme || 'dark';
        if (theme === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
        }
    </script>
    <style>
        /* Demi Health Dashboard Styles */
        :root {
            --primary-color: #6c5ce7;
            --secondary-color: #a29bfe;
            --success-color: #00b894;
            --warning-color: #fdcb6e;
            --danger-color: #e17055;
            --info-color: #74b9ff;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-color: #2d3436;
            --text-muted: #636e72;
            --border-color: #dfe6e9;
            --shadow-color: rgba(0, 0, 0, 0.08);
        }

        [data-theme="dark"] {
            --primary-color: #a29bfe;
            --secondary-color: #6c5ce7;
            --success-color: #00d2d3;
            --warning-color: #f9ca24;
            --danger-color: #ff6348;
            --info-color: #54a0ff;
            --bg-color: #1a1a2e;
            --card-bg: #16213e;
            --text-color: #eaeaea;
            --text-muted: #b8b8b8;
            --border-color: #2d3561;
            --shadow-color: rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
        }

        header h1 {
            font-size: 1.8rem;
            color: var(--primary-color);
        }

        .connection-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .connection-status.connected {
            background: var(--success-color);
            color: white;
        }

        .connection-status.disconnected {
            background: var(--danger-color);
            color: white;
        }

        .connection-status.connecting {
            background: var(--warning-color);
            color: var(--text-color);
        }

        .connection-status.error {
            background: var(--danger-color);
            color: white;
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px var(--shadow-color);
            transition: background 0.3s ease, box-shadow 0.3s ease;
        }

        .card h2 {
            font-size: 1.2rem;
            margin-bottom: 16px;
            color: var(--text-color);
        }

        /* Main Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 24px;
        }

        .card.full-width {
            grid-column: 1 / -1;
        }

        /* Health Overview */
        .health-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 16px;
        }

        .health-item {
            text-align: center;
            padding: 16px;
            border-radius: 8px;
            background: var(--bg-color);
        }

        .health-item.healthy {
            background: rgba(0, 184, 148, 0.1);
            border: 2px solid var(--success-color);
        }

        .health-item.warning {
            background: rgba(253, 203, 110, 0.1);
            border: 2px solid var(--warning-color);
        }

        .health-item.critical {
            background: rgba(225, 112, 85, 0.1);
            border: 2px solid var(--danger-color);
        }

        .health-item .label {
            display: block;
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 4px;
        }

        .health-item .value {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .status-healthy { color: var(--success-color); }
        .status-warning { color: var(--warning-color); }
        .status-critical { color: var(--danger-color); }

        /* Resource Metrics */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 16px;
        }

        .metric {
            text-align: center;
        }

        .metric-label {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .metric-bar {
            height: 24px;
            background: var(--bg-color);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .metric-fill {
            height: 100%;
            background: var(--success-color);
            transition: width 0.3s ease, background 0.3s ease;
            border-radius: 12px;
        }

        .metric-fill.warning {
            background: var(--warning-color);
        }

        .metric-fill.critical {
            background: var(--danger-color);
        }

        .metric-value {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .memory-details {
            display: flex;
            justify-content: space-around;
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-top: 12px;
        }

        .memory-details span span {
            color: var(--text-color);
            font-weight: 500;
        }

        /* Emotional State */
        .emotion-radar-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        #emotion-radar {
            max-width: 100%;
            height: auto;
        }

        .emotion-legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 8px;
        }

        .emotion-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            padding: 4px 8px;
            border-radius: 4px;
            background: var(--bg-color);
        }

        .emotion-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .emotion-value {
            margin-left: auto;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .emotion-value.high { color: var(--danger-color); }
        .emotion-value.medium { color: var(--warning-color); }
        .emotion-value.low { color: var(--success-color); }

        /* Alerts */
        #alerts-container {
            max-height: 300px;
            overflow-y: auto;
        }

        .alert-placeholder {
            text-align: center;
            color: var(--text-muted);
            padding: 20px;
        }

        .alert-item {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 4px solid;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .alert-item.info {
            background: rgba(116, 185, 255, 0.1);
            border-left-color: var(--info-color);
        }

        .alert-item.warning {
            background: rgba(253, 203, 110, 0.1);
            border-left-color: var(--warning-color);
        }

        .alert-item.critical {
            background: rgba(225, 112, 85, 0.1);
            border-left-color: var(--danger-color);
        }

        .alert-content {
            flex: 1;
        }

        .alert-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
        }

        .alert-severity {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .alert-time {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .alert-message {
            font-size: 0.9rem;
            margin-bottom: 4px;
        }

        .alert-rule {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .alert-actions {
            display: flex;
            gap: 8px;
        }

        .btn-ack, .btn-resolve {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .btn-ack {
            background: var(--info-color);
            color: white;
        }

        .btn-resolve {
            background: var(--success-color);
            color: white;
        }

        .btn-ack:hover, .btn-resolve:hover {
            opacity: 0.8;
        }

        /* Platform Status */
        .platform-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
        }

        .platform-item {
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .platform-item.healthy {
            border-color: var(--success-color);
            background: rgba(0, 184, 148, 0.05);
        }

        .platform-item.degraded {
            border-color: var(--warning-color);
            background: rgba(253, 203, 110, 0.05);
        }

        .platform-item.unhealthy {
            border-color: var(--danger-color);
            background: rgba(225, 112, 85, 0.05);
        }

        .platform-item.unknown {
            border-color: var(--border-color);
            background: var(--bg-color);
        }

        .platform-name {
            display: block;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .platform-status {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-transform: capitalize;
        }

        /* Charts */
        .chart-container {
            position: relative;
            height: 250px;
        }

        .chart canvas {
            width: 100%;
            height: 100%;
        }

        /* Theme Toggle */
        .theme-toggle {
            background: none;
            border: 2px solid var(--border-color);
            color: var(--text-color);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .theme-toggle:hover {
            background: var(--bg-color);
            border-color: var(--primary-color);
        }

        /* Footer */
        footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            text-align: center;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 12px;
            }

            header {
                flex-direction: column;
                gap: 12px;
                text-align: center;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .health-grid {
                grid-template-columns: 1fr;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .emotion-legend {
                grid-template-columns: 1fr;
            }
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-color);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        /* Loading spinner */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Metrics Grid - 2 column layout */
        .metrics-2col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        /* Status Indicators */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .status-indicator.online {
            background: rgba(0, 184, 148, 0.1);
            color: var(--success-color);
        }

        .status-indicator.offline {
            background: rgba(225, 112, 85, 0.1);
            color: var(--danger-color);
        }

        .status-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-dot.online {
            background: var(--success-color);
        }

        .status-dot.offline {
            background: var(--danger-color);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* Discord Status Card */
        .discord-card {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 16px;
            padding: 16px;
            background: var(--bg-color);
            border-radius: 8px;
        }

        .discord-stat {
            text-align: center;
        }

        .discord-stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 8px;
        }

        .discord-stat-label {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        /* Performance Metrics Display */
        .perf-metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--bg-color);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .perf-metric-label {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .perf-metric-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        /* Quality Score */
        .quality-score {
            display: inline-block;
            padding: 8px 16px;
            background: var(--bg-color);
            border-radius: 8px;
            font-weight: 600;
            font-size: 1rem;
        }

        .quality-score.good {
            color: var(--success-color);
        }

        .quality-score.fair {
            color: var(--warning-color);
        }

        .quality-score.poor {
            color: var(--danger-color);
        }

        /* Responsive adjustments */
        @media (max-width: 1000px) {
            .metrics-2col {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 12px;
            }

            header {
                flex-direction: column;
                gap: 12px;
                text-align: center;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .health-grid {
                grid-template-columns: 1fr;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .emotion-legend {
                grid-template-columns: 1fr;
            }

            .discord-card {
                grid-template-columns: 1fr;
            }

            .metrics-2col {
                grid-template-columns: 1fr;
            }
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-color);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ”® Demi Health Dashboard</h1>
            <div style="display: flex; gap: 12px; align-items: center;">
                <button class="theme-toggle" id="theme-toggle" title="Toggle dark mode" aria-label="Toggle dark mode">
                    <span id="theme-icon">ðŸŒ™</span>
                </button>
                <div class="connection-status connecting" id="connection-status">Connecting...</div>
            </div>
        </header>

        <div class="dashboard-grid">
            <!-- System Health Overview -->
            <section class="card">
                <h2>System Health</h2>
                <div class="health-grid" id="health-grid">
                    <div class="health-item">
                        <span class="label">Status</span>
                        <span class="value" id="health-status">--</span>
                    </div>
                    <div class="health-item">
                        <span class="label">Uptime</span>
                        <span class="value" id="uptime">--</span>
                    </div>
                    <div class="health-item">
                        <span class="label">Last Update</span>
                        <span class="value" id="last-update">--</span>
                    </div>
                </div>
            </section>

            <!-- Resource Metrics -->
            <section class="card">
                <h2>Resource Usage</h2>
                <div class="metrics-grid">
                    <div class="metric">
                        <div class="metric-label">Memory</div>
                        <div class="metric-bar">
                            <div class="metric-fill" id="memory-bar" style="width: 0%"></div>
                        </div>
                        <div class="metric-value" id="memory-value">--</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">CPU</div>
                        <div class="metric-bar">
                            <div class="metric-fill" id="cpu-bar" style="width: 0%"></div>
                        </div>
                        <div class="metric-value" id="cpu-value">--</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">Disk</div>
                        <div class="metric-bar">
                            <div class="metric-fill" id="disk-bar" style="width: 0%"></div>
                        </div>
                        <div class="metric-value" id="disk-value">--</div>
                    </div>
                </div>
                <div class="memory-details">
                    <span>Used: <span id="memory-used">--</span> GB</span>
                    <span>Available: <span id="memory-available">--</span> GB</span>
                    <span>Total: <span id="memory-total">--</span> GB</span>
                </div>
            </section>

            <!-- Emotional State Visualization -->
            <section class="card">
                <h2>Demi's Emotional State</h2>
                <div class="emotion-radar-container">
                    <canvas id="emotion-radar" width="300" height="300"></canvas>
                </div>
                <div class="emotion-legend" id="emotion-legend">
                    <!-- Dynamically populated -->
                </div>
            </section>

            <!-- Active Alerts -->
            <section class="card">
                <h2>Active Alerts <span id="alert-count"></span></h2>
                <div id="alerts-container">
                    <div class="alert-placeholder">No active alerts</div>
                </div>
            </section>

            <!-- Platform Status -->
            <section class="card full-width">
                <h2>Platform Status</h2>
                <div class="platform-grid" id="platform-grid">
                    <div class="platform-item unknown">
                        <span class="platform-name">Discord</span>
                        <span class="platform-status">Unknown</span>
                    </div>
                    <div class="platform-item unknown">
                        <span class="platform-name">Android</span>
                        <span class="platform-status">Unknown</span>
                    </div>
                    <div class="platform-item unknown">
                        <span class="platform-name">LLM</span>
                        <span class="platform-status">Unknown</span>
                    </div>
                </div>
            </section>

            <!-- Discord Bot Status -->
            <section class="card">
                <h2>ðŸ¤– Discord Bot Status</h2>
                <div style="margin-bottom: 16px;">
                    <div class="status-indicator" id="discord-status-indicator">
                        <span class="status-dot offline"></span>
                        <span>Offline</span>
                    </div>
                </div>
                <div class="discord-card" id="discord-stats">
                    <div class="discord-stat">
                        <div class="discord-stat-value" id="discord-latency">--</div>
                        <div class="discord-stat-label">Latency (ms)</div>
                    </div>
                    <div class="discord-stat">
                        <div class="discord-stat-value" id="discord-guilds">--</div>
                        <div class="discord-stat-label">Guilds</div>
                    </div>
                    <div class="discord-stat">
                        <div class="discord-stat-value" id="discord-users">--</div>
                        <div class="discord-stat-label">Users</div>
                    </div>
                </div>
            </section>

            <!-- LLM Performance Metrics -->
            <section class="card">
                <h2>âš¡ LLM Performance</h2>
                <div id="llm-metrics" style="display: flex; flex-direction: column; gap: 12px;">
                    <div class="perf-metric">
                        <span class="perf-metric-label">Avg Response Time</span>
                        <span class="perf-metric-value" id="llm-avg-response">-- ms</span>
                    </div>
                    <div class="perf-metric">
                        <span class="perf-metric-label">Max Response Time</span>
                        <span class="perf-metric-value" id="llm-max-response">-- ms</span>
                    </div>
                    <div class="perf-metric">
                        <span class="perf-metric-label">Tokens (1h)</span>
                        <span class="perf-metric-value" id="llm-total-tokens">--</span>
                    </div>
                </div>
            </section>

            <!-- Conversation Quality -->
            <section class="card">
                <h2>ðŸ’¬ Conversation Quality</h2>
                <div id="conversation-metrics" style="display: flex; flex-direction: column; gap: 12px;">
                    <div class="perf-metric">
                        <span class="perf-metric-label">Avg User Message Length</span>
                        <span class="perf-metric-value" id="conv-user-length">-- chars</span>
                    </div>
                    <div class="perf-metric">
                        <span class="perf-metric-label">Avg Response Length</span>
                        <span class="perf-metric-value" id="conv-response-length">-- chars</span>
                    </div>
                    <div class="perf-metric">
                        <span class="perf-metric-label">Avg Sentiment</span>
                        <span class="perf-metric-value" id="conv-sentiment">--</span>
                    </div>
                    <div class="perf-metric">
                        <span class="perf-metric-label">Max Conversation Turn</span>
                        <span class="perf-metric-value" id="conv-max-turn">--</span>
                    </div>
                </div>
            </section>

            <!-- Emotion History Chart -->
            <section class="card full-width">
                <h2>Emotion State Trend</h2>
                <div class="chart-container">
                    <canvas id="emotion-history-chart" width="800" height="250"></canvas>
                </div>
            </section>

            <!-- Platform Metrics Chart -->
            <section class="card full-width">
                <h2>Platform Interaction Metrics</h2>
                <div id="platform-metrics-display" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px;">
                    <!-- Dynamically populated -->
                </div>
            </section>

            <!-- Mobile App Metrics -->
            <section class="card full-width">
                <h2>ðŸ“± Mobile App Metrics</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-top: 15px;">
                    <div style="padding: 15px; background: var(--secondary-bg); border-radius: 8px; text-align: center;">
                        <div style="font-size: 28px; font-weight: bold; color: #4ecdc4;" id="mobile-connections">0</div>
                        <div style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;">Active WebSocket Connections</div>
                    </div>
                    <div style="padding: 15px; background: var(--secondary-bg); border-radius: 8px; text-align: center;">
                        <div style="font-size: 28px; font-weight: bold; color: #a8e6cf;" id="mobile-sessions">0</div>
                        <div style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;">Total User Sessions</div>
                    </div>
                    <div style="padding: 15px; background: var(--secondary-bg); border-radius: 8px; text-align: center;">
                        <div style="font-size: 14px; color: var(--text-primary);" id="mobile-status">Checking...</div>
                        <div style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;">Server Status</div>
                    </div>
                </div>
                <div style="margin-top: 15px; font-size: 12px; color: var(--text-secondary);" id="mobile-details">
                    <!-- Dynamically populated with connection details -->
                </div>
            </section>

            <!-- Memory Usage History Chart -->
            <section class="card full-width">
                <h2>Memory Usage History</h2>
                <div class="chart-container">
                    <canvas id="memory-chart" width="800" height="250"></canvas>
                </div>
            </section>

            <!-- Response Time Chart -->
            <section class="card full-width">
                <h2>Response Time</h2>
                <div class="chart-container">
                    <canvas id="response-chart" width="800" height="200"></canvas>
                </div>
            </section>
        </div>

        <footer>
            <p>Demi Health Dashboard v1.0 | <span id="websocket-status">Disconnected</span></p>
        </footer>
    </div>

    <script src="/dashboard_static/dashboard.js"></script>
</body>
</html>
